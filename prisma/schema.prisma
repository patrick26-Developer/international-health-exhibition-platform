generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Utilisateur {
  id                    String                @id @default(cuid())
  email                 String                @unique
  motDePasse            String
  prenom                String
  nom                   String
  telephone             String?               @unique
  pays                  String?
  ville                 String?
  adresse               String?
  codePostal            String?
  langue                String                @default("fr")
  typeUtilisateur       TypeUtilisateur       @default(VISITEUR)
  statutCompte          StatutCompte          @default(EN_ATTENTE_VERIFICATION)
  emailVerifie          Boolean               @default(false)
  dateVerificationEmail DateTime?
  derniereConnexion     DateTime?
  adresseIPConnexion    String?
  tentativesEchouees    Int                   @default(0)
  compteBloqueLe        DateTime?
  raisonBlocage         String?
  photoProfil           String?
  biographie            String?
  siteWeb               String?
  organisation          String?
  poste                 String?
  reseauxSociaux        Json?
  accepteNewsletter     Boolean               @default(true)
  accepteNotifications  Boolean               @default(true)
  notificationsSMS      Boolean               @default(false)
  dateCreation          DateTime              @default(now())
  dateModification      DateTime              @updatedAt
  dateSuppression       DateTime?
  derniereActivite      DateTime?             @default(now())
  activites             ActiviteUtilisateur[]
  benevoles             Benevole[]
  exposants             Exposant[]
  historiqueConnexions  HistoriqueConnexion[]
  historiqueMDP         HistoriqueMDP[]
  inscriptions          Inscription[]
  journauxAudit         JournalAudit[]
  medias                Media[]
  notifications         Notification[]
  otps                  OTP[]
  partenaire            Partenaire?
  sessions              Session[]

  @@index([email])
  @@index([telephone])
  @@index([typeUtilisateur])
  @@index([statutCompte])
  @@index([emailVerifie])
  @@map("utilisateurs")
}

model OTP {
  id              String      @id @default(cuid())
  utilisateurId   String
  type            TypeOTP
  code            String
  destinataire    String
  expiresAt       DateTime
  tentatives      Int         @default(0)
  statut          StatutOTP   @default(EN_ATTENTE)
  metadata        Json?
  dateCreation    DateTime    @default(now())
  dateUtilisation DateTime?
  utilisateur     Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([code])
  @@index([destinataire])
  @@index([type])
  @@index([expiresAt])
  @@index([statut])
  @@map("otps")
}

model Session {
  id               String      @id @default(cuid())
  utilisateurId    String
  jeton            String      @unique
  jetonRafraichi   String?     @unique
  adresseIP        String?
  userAgent        String?
  expiresAt        DateTime
  dernierAcces     DateTime    @default(now())
  estActive        Boolean     @default(true)
  dateCreation     DateTime    @default(now())
  dateModification DateTime    @updatedAt
  utilisateur      Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([jeton])
  @@index([expiresAt])
  @@map("sessions")
}

model HistoriqueConnexion {
  id            String      @id @default(cuid())
  utilisateurId String
  adresseIP     String?
  userAgent     String?
  reussi        Boolean     @default(true)
  raisonEchec   String?
  dateCreation  DateTime    @default(now())
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([reussi])
  @@index([dateCreation])
  @@map("historique_connexions")
}

model HistoriqueMDP {
  id            String      @id @default(cuid())
  utilisateurId String
  hashMDP       String
  dateCreation  DateTime    @default(now())
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@map("historique_mdp")
}

model ActiviteUtilisateur {
  id            String      @id @default(cuid())
  utilisateurId String
  action        String
  description   String?
  adresseIP     String?
  userAgent     String?
  dateCreation  DateTime    @default(now())
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([action])
  @@map("activites_utilisateurs")
}

model JournalAudit {
  id            String       @id @default(cuid())
  utilisateurId String?
  action        ActionAudit
  entite        String
  entiteId      String?
  modifications Json?
  adresseIP     String?
  userAgent     String?
  dateCreation  DateTime     @default(now())
  utilisateur   Utilisateur? @relation(fields: [utilisateurId], references: [id])

  @@index([utilisateurId])
  @@index([action])
  @@index([entite])
  @@index([dateCreation])
  @@map("journaux_audit")
}

model FileAttenteEmail {
  id            String    @id @default(cuid())
  type          String
  destinataire  String
  sujet         String
  contenuHTML   String
  contenuText   String?
  statut        String    @default("EN_ATTENTE")
  tentatives    Int       @default(0)
  erreur        String?
  messageId     String?
  otpId         String?
  dateCreation  DateTime  @default(now())
  dateEnvoi     DateTime?
  prochainEssai DateTime?

  @@index([destinataire])
  @@index([statut])
  @@index([type])
  @@index([dateCreation])
  @@map("file_attente_email")
}

model Edition {
  id                       String             @id @default(cuid())
  nom                      String
  slug                     String             @unique
  ville                    String
  pays                     String
  lieu                     String?
  dateDebut                DateTime
  dateFin                  DateTime
  description              String?
  thematique               String?
  statut                   StatutEdition      @default(PLANIFIEE)
  siteWeb                  String?
  emailContact             String?
  telephoneContact         String?
  estPublique              Boolean            @default(true)
  estArchivee              Boolean            @default(false)
  dateCreation             DateTime           @default(now())
  dateModification         DateTime           @updatedAt
  capaciteEstimeeBenevoles Int?
  capaciteEstimeeExposants Int?
  capaciteEstimeeVisiteurs Int?
  dateFinInscriptions      DateTime?
  benevoles                Benevole[]
  bilan                    BilanEdition?
  exposants                Exposant[]
  inscriptions             Inscription[]
  medias                   Media[]
  programmes               ProgrammeEdition[]
  statistiques             Statistique[]

  @@index([slug])
  @@index([statut])
  @@index([dateDebut])
  @@map("editions")
}

model BilanEdition {
  id                     String   @id @default(cuid())
  editionId              String   @unique
  nombreVisiteurs        Int
  nombreExposants        Int
  nombreBenevoles        Int
  actionsSensibilisation Int
  partenariatsActifs     Int
  retombeesSociales      String?
  retombeesSanitaires    String?
  satisfactionMoyenne    Float?
  recommandation         Int?
  datePublication        DateTime @default(now())
  edition                Edition  @relation(fields: [editionId], references: [id], onDelete: Cascade)

  @@map("bilans_editions")
}

model Inscription {
  id              String            @id @default(cuid())
  utilisateurId   String
  editionId       String
  typeInscription TypeInscription
  statut          StatutInscription @default(EN_ATTENTE)
  dateInscription DateTime          @default(now())
  dateValidation  DateTime?
  commentaire     String?
  centresInteret  Json?
  nomOrganisation String?
  secteurActivite String?
  competences     String?
  disponibilites  Json?
  edition         Edition           @relation(fields: [editionId], references: [id], onDelete: Cascade)
  utilisateur     Utilisateur       @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([utilisateurId, editionId, typeInscription])
  @@index([utilisateurId])
  @@index([editionId])
  @@index([statut])
  @@map("inscriptions")
}

model Exposant {
  id               String      @id @default(cuid())
  utilisateurId    String
  editionId        String
  nomOrganisation  String
  typeOrganisation String
  secteurActivite  String
  description      String?
  logo             String?
  emplacementStand String?
  numeroStand      String?
  siteWeb          String?
  personneContact  String?
  emailContact     String?
  telephoneContact String?
  statut           String      @default("EN_ATTENTE")
  dateCreation     DateTime    @default(now())
  dateModification DateTime    @updatedAt
  motifRefus       String?
  edition          Edition     @relation(fields: [editionId], references: [id], onDelete: Cascade)
  utilisateur      Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([utilisateurId, editionId])
  @@index([utilisateurId])
  @@index([editionId])
  @@map("exposants")
}

model Benevole {
  id                String      @id @default(cuid())
  utilisateurId     String
  editionId         String
  competences       String?
  disponibilites    Json?
  tachesPreferees   String?
  missionsAssignees String?
  statut            String      @default("CANDIDAT")
  dateCreation      DateTime    @default(now())
  dateModification  DateTime    @updatedAt
  experience        String?
  motivation        String?
  edition           Edition     @relation(fields: [editionId], references: [id], onDelete: Cascade)
  utilisateur       Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@unique([utilisateurId, editionId])
  @@index([utilisateurId])
  @@index([editionId])
  @@map("benevoles")
}

model Partenaire {
  id                String      @id @default(cuid())
  utilisateurId     String      @unique
  nomOrganisation   String
  typePartenaire    String
  niveauPartenariat String?
  description       String?
  logo              String?
  siteWeb           String?
  personneContact   String?
  emailContact      String?
  telephoneContact  String?
  dateDebut         DateTime?
  dateFin           DateTime?
  afficherSurSite   Boolean     @default(true)
  dateCreation      DateTime    @default(now())
  dateModification  DateTime    @updatedAt
  utilisateur       Utilisateur @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@map("partenaires")
}

model ProgrammeEdition {
  id               String        @id @default(cuid())
  editionId        String
  type             TypeProgramme
  titre            String
  description      String?
  dateDebut        DateTime
  dateFin          DateTime
  lieu             String?
  intervenants     Json?
  maxParticipants  Int?
  dateCreation     DateTime      @default(now())
  dateModification DateTime      @updatedAt
  edition          Edition       @relation(fields: [editionId], references: [id], onDelete: Cascade)

  @@index([editionId])
  @@index([type])
  @@map("programmes_editions")
}

model Media {
  id               String      @id @default(cuid())
  titre            String
  description      String?
  typeMedia        TypeMedia
  url              String
  miniature        String?
  editionId        String?
  auteurId         String
  estPublic        Boolean     @default(true)
  dateCreation     DateTime    @default(now())
  dateModification DateTime    @updatedAt
  auteur           Utilisateur @relation(fields: [auteurId], references: [id], onDelete: Cascade)
  edition          Edition?    @relation(fields: [editionId], references: [id])

  @@index([auteurId])
  @@index([editionId])
  @@map("medias")
}

model Notification {
  id            String           @id @default(cuid())
  utilisateurId String
  type          TypeNotification
  titre         String
  message       String
  lue           Boolean          @default(false)
  lien          String?
  dateCreation  DateTime         @default(now())
  dateLecture   DateTime?
  utilisateur   Utilisateur      @relation(fields: [utilisateurId], references: [id], onDelete: Cascade)

  @@index([utilisateurId])
  @@index([lue])
  @@map("notifications")
}

model ConfigEmail {
  id               String   @id @default(cuid())
  provider         String   @default("nodemailer")
  host             String?
  port             Int?
  secure           Boolean? @default(false)
  auth             Json?
  senderEmail      String
  senderName       String
  estActif         Boolean  @default(true)
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt

  @@map("configs_email")
}

model Parametre {
  id               String   @id @default(cuid())
  cle              String   @unique
  valeur           String
  description      String?
  estPublic        Boolean  @default(false)
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt

  @@index([cle])
  @@map("parametres")
}

model Statistique {
  id                    String   @id @default(cuid())
  editionId             String?
  date                  DateTime @default(now())
  nombreVisiteurs       Int      @default(0)
  nombreInscriptions    Int      @default(0)
  inscriptionsExposants Int      @default(0)
  inscriptionsBenevoles Int      @default(0)
  edition               Edition? @relation(fields: [editionId], references: [id])

  @@index([editionId])
  @@index([date])
  @@map("statistiques")
}

enum TypeUtilisateur {
  SUPER_ADMIN
  ADMIN
  PARTENAIRE
  EXPOSANT
  BENEVOLE
  VISITEUR
  MEDIA
}

enum StatutCompte {
  ACTIF
  INACTIF
  SUSPENDU
  EN_ATTENTE_VERIFICATION
  SUPPRIME
}

enum StatutEdition {
  PLANIFIEE
  EN_COURS
  TERMINEE
  ANNULEE
  BROUILLON
  INSCRIPTIONS_OUVERTES
  INSCRIPTIONS_FERMEES
}

enum TypeProgramme {
  SPORT_SANTE
  NUTRITION
  BIEN_ETRE
  PREVENTION_MNT
  SANTE_MENTALE
}

enum TypeMedia {
  PHOTO
  VIDEO
  DOCUMENT
  COMMUNIQUE_PRESSE
  INFOGRAPHIE
  RAPPORT
}

enum TypeNotification {
  INFO
  SUCCES
  AVERTISSEMENT
  ERREUR
  ACTION_REQUISE
}

enum TypeOTP {
  VERIFICATION_EMAIL
  REINITIALISATION_MDP
  CHANGEMENT_EMAIL
  SUPPRESSION_COMPTE
}

enum StatutOTP {
  EN_ATTENTE
  VERIFIE
  EXPIRE
  ANNULE
}

enum ActionAudit {
  CREATION
  MODIFICATION
  SUPPRESSION
  CONNEXION
  DECONNEXION
  INSCRIPTION
  VERIFICATION_EMAIL
  REINITIALISATION_MDP
  CHANGEMENT_EMAIL
  CHANGEMENT_MDP
  APPROBATION
  REJET
  PUBLICATION
}

enum TypeInscription {
  VISITEUR
  EXPOSANT
  BENEVOLE
}

enum StatutInscription {
  EN_ATTENTE
  VALIDEE
  REFUSEE
  ANNULEE
}
